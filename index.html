<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>幾何探究學習工具</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background: #f4f7f6; margin: 0; padding: 20px; }
        .controls { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; }
        #canvas-container { width: 90vw; max-width: 600px; aspect-ratio: 1 / 1; position: relative; background: white; border: 2px solid #ddd; background-image: linear-gradient(#eee 1px, transparent 1px), linear-gradient(90deg, #eee 1px, transparent 1px); }
        canvas { display: block; cursor: crosshair; }
        #infoPanel { margin-top: 20px; padding: 20px; background: #e8f4fd; border-left: 6px solid #2196f3; width: 90%; max-width: 600px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="controls">
    <select id="gridSize">
        <option value="5">5x5</option>
        <option value="9">9x9</option>
        <option value="16">16x16</option>
    </select>
    <button onclick="undoLastLine()">復原</button>
    <button onclick="calculateShape()">計算面積與分類</button>
    <button onclick="clearCanvas()">清空</button>
</div>

<div id="canvas-container">
    <canvas id="gridCanvas"></canvas>
</div>

<div id="infoPanel">點擊網格點即可連線，系統會自動幫您標記點名 (A, B, C...)。</div>

<script>
    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-container');
    let gridSize = 5, lines = [], startPoint = null, pointsLog = [], labels = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 繪製線條
        lines.forEach(line => {
            ctx.beginPath(); ctx.moveTo(line.start.x, line.start.y); ctx.lineTo(line.end.x, line.end.y);
            ctx.strokeStyle = "#333"; ctx.lineWidth = 4; ctx.stroke();
        });

        // 繪製頂點與字母標籤
        pointsLog.forEach((p, index) => {
            ctx.fillStyle = "#2196f3";
            ctx.beginPath(); ctx.arc(p.x, p.y, 6, 0, Math.PI*2); ctx.fill();
            ctx.fillStyle = "black";
            ctx.font = "bold 16px Arial";
            ctx.fillText(labels[index] || index, p.x + 8, p.y - 8);
        });
    }

    function calculateShape() {
        if(lines.length < 3) return;
        
        // 視覺填充
        ctx.fillStyle = "rgba(33, 150, 243, 0.2)";
        ctx.beginPath();
        ctx.moveTo(lines[0].start.x, lines[0].start.y);
        lines.forEach(l => ctx.lineTo(l.end.x, l.end.y));
        ctx.closePath();
        ctx.fill();
        ctx.stroke();

        document.getElementById('infoPanel').innerHTML = `
            <strong>圖形分析：</strong><br>
            已標註頂點：${pointsLog.map((_, i) => labels[i]).join(', ')}<br>
            您可以根據標籤說出：例如「角 ABC」或「邊 AB」。
        `;
    }

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left, my = e.clientY - rect.top;
        const cellSize = canvas.width / (gridSize - 1);
        const closest = {x: Math.round(mx/cellSize)*cellSize, y: Math.round(my/cellSize)*cellSize};
        
        if(startPoint) {
            lines.push({start: startPoint, end: closest});
            if(!pointsLog.find(p => p.x === closest.x && p.y === closest.y)) pointsLog.push(closest);
            startPoint = null;
        } else {
            startPoint = closest;
            if(!pointsLog.find(p => p.x === closest.x && p.y === closest.y)) pointsLog.push(closest);
        }
        draw();
    });

    function undoLastLine() { lines.pop(); draw(); }
    function clearCanvas() { lines = []; startPoint = null; pointsLog = []; draw(); }
    document.getElementById('gridSize').addEventListener('change', (e) => { gridSize = parseInt(e.target.value); clearCanvas(); });
    init();
    function init() { canvas.width = container.clientWidth; canvas.height = container.clientHeight; draw(); }
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>幾何探究學習工具</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f4f7f6; padding: 20px; }
        .controls { background: white; padding: 15px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #canvas-container { 
            width: 90vw; max-width: 600px; aspect-ratio: 1 / 1; position: relative; 
            background: white; border: 2px solid #ccc;
            background-image: linear-gradient(#eee 1px, transparent 1px), linear-gradient(90deg, #eee 1px, transparent 1px);
        }
        canvas { display: block; cursor: crosshair; }
        #infoPanel { margin-top: 20px; padding: 15px; background: #fff; border-left: 5px solid #666; width: 90%; max-width: 600px; }
    </style>
</head>
<body>

<div class="controls">
    <select id="gridSize">
        <option value="5">5x5</option><option value="9">9x9</option><option value="16">16x16</option>
    </select>
    <button onclick="clearCanvas()">全部清除</button>
    <span style="margin-left:10px; font-size:0.9em; color:#666;">(左鍵連線，右鍵標註點名)</span>
</div>

<div id="canvas-container">
    <canvas id="canvas"></canvas>
</div>

<div id="infoPanel">提示：左鍵點擊網格建立連線；在點上點擊右鍵可手動加上名稱。</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let gridSize = 5, lines = [], startPoint = null, labels = [];

    function draw() {
        const cellSize = canvas.width / (gridSize - 1);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 畫網格點
        for(let i=0; i<gridSize; i++) {
            for(let j=0; j<gridSize; j++) {
                ctx.fillStyle = "#ccc";
                ctx.beginPath(); ctx.arc(j*cellSize, i*cellSize, 3, 0, Math.PI*2); ctx.fill();
            }
        }
        // 畫線
        lines.forEach(l => {
            ctx.strokeStyle = "#333"; ctx.lineWidth = 4;
            ctx.beginPath(); ctx.moveTo(l.start.x, l.start.y); ctx.lineTo(l.end.x, l.end.y); ctx.stroke();
        });
        // 畫標記
        labels.forEach(lb => {
            ctx.fillStyle = "black"; ctx.font = "bold 18px Arial";
            ctx.fillText(lb.text, lb.x + 8, lb.y - 8);
        });
    }

    // 取得最近的格點
    function getClosest(mx, my) {
        const cellSize = canvas.width / (gridSize - 1);
        return { x: Math.round(mx/cellSize)*cellSize, y: Math.round(my/cellSize)*cellSize };
    }

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const p = getClosest(e.clientX - rect.left, e.clientY - rect.top);
        if(startPoint) {
            lines.push({start: startPoint, end: p});
            startPoint = null;
        } else { startPoint = p; }
        draw();
    });

    // 右鍵標記點名
    canvas.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        const rect = canvas.getBoundingClientRect();
        const p = getClosest(e.clientX - rect.left, e.clientY - rect.top);
        const name = prompt("請輸入點名 (例如 A):", "A");
        if(name) labels.push({x: p.x, y: p.y, text: name});
        draw();
    });

    function clearCanvas() { lines = []; labels = []; startPoint = null; draw(); }
    document.getElementById('gridSize').addEventListener('change', (e) => { gridSize = parseInt(e.target.value); clearCanvas(); });
    window.onload = () => { canvas.width = canvas.parentElement.clientWidth; canvas.height = canvas.parentElement.clientHeight; draw(); };
</script>
</body>
</html>

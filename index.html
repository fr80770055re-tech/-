<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¾ä½•æ¢ç©¶å­¸ç¿’å·¥å…· - å®Œæ•´ç‰ˆ</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f4f7f6; margin: 0; padding: 20px; 
            display: flex; justify-content: center;
        }
        .main-container {
            display: flex; flex-wrap: wrap; gap: 20px; max-width: 1200px; width: 100%;
        }
        /* å·¦å´ç•«å¸ƒå€ */
        .canvas-section {
            flex: 1 1 500px;
        }
        #canvas-container { 
            width: 100%; aspect-ratio: 1 / 1; position: relative; 
            background: white; border: 2px solid #ccc; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            /* é¢ç©è¼”åŠ©æ ¼ç·š */
            background-image: linear-gradient(#ddd 1px, transparent 1px), linear-gradient(90deg, #ddd 1px, transparent 1px);
        }
        canvas { display: block; cursor: crosshair; position: absolute; top: 0; left: 0; }
        
        /* å³å´æ§åˆ¶èˆ‡è³‡è¨Šå€ */
        .sidebar {
            flex: 1 1 350px; display: flex; flex-direction: column; gap: 15px;
        }
        .controls { 
            background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); 
            display: flex; flex-direction: column; gap: 12px;
        }
        .control-row { display: flex; align-items: center; justify-content: space-between; gap: 10px; }
        .control-row label { font-weight: bold; color: #444; font-size: 0.9em; }
        button { 
            padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; 
            background: #e0e0e0; font-weight: bold; transition: 0.2s;
        }
        button:hover { background: #ccc; }
        button.primary { background: #2196f3; color: white; }
        button.primary:hover { background: #1976d2; }
        
        #infoPanel { 
            padding: 20px; background: #e8f4fd; border-left: 6px solid #2196f3; 
            border-radius: 8px; flex-grow: 1; line-height: 1.6; font-size: 1.05em;
        }
        .instruction { font-size: 0.85em; color: #666; background: #f9f9f9; padding: 10px; border-radius: 6px; }
    </style>
</head>
<body>

<div class="main-container">
    <div class="canvas-section">
        <div id="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
    </div>

    <div class="sidebar">
        <div class="controls">
            <div class="control-row">
                <label>é¸æ“‡ç¶²æ ¼ï¼š</label>
                <select id="gridSize">
                    <option value="5">5x5</option>
                    <option value="9">9x9</option>
                    <option value="16">16x16</option>
                </select>
            </div>
            <div class="control-row">
                <label>ç·šæ¢é¡è‰²ï¼š</label>
                <input type="color" id="lineColor" value="#333333">
            </div>
            <div class="control-row">
                <label>ç·šæ¢ç²—ç´°ï¼š</label>
                <input type="range" id="lineWidth" min="2" max="10" value="4">
            </div>
            <div class="control-row">
                <button onclick="undoLastLine()">å¾©åŸä¸Šä¸€ç­†</button>
                <button onclick="clearCanvas()">å…¨éƒ¨æ¸…ç©º</button>
            </div>
            <button class="primary" onclick="calculateShape()">è¨ˆç®—é¢ç©èˆ‡åˆ†é¡åœ–å½¢</button>
            
            <div class="instruction">
                <strong>æ“ä½œèªªæ˜ï¼š</strong><br>
                1. <strong>å·¦éµé»æ“Šï¼š</strong>åœ¨ç¶²æ ¼é»ä¸Šæ‹‰å‡ºç·šæ¢ã€‚<br>
                2. <strong>å³éµé»æ“Šï¼š</strong>æ‰‹å‹•æ¨™è¨»é»çš„åç¨± (å¦‚ A, B, C)ã€‚
            </div>
        </div>

        <div id="infoPanel">
            <strong>åˆ†æçµæœå°‡é¡¯ç¤ºæ–¼æ­¤ã€‚</strong><br>
            è«‹å…ˆåœ¨å·¦æ–¹ç•«å¸ƒå®Œæˆä¸€å€‹å°é–‰åœ–å½¢ï¼
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-container');
    let gridSize = 5, lines = [], startPoint = null, labels = [], mousePos = {x:0, y:0};

    // åˆå§‹åŒ–èˆ‡éŸ¿æ‡‰å¼èª¿æ•´
    function init() {
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        const cellSize = canvas.width / (gridSize - 1);
        container.style.backgroundSize = `${cellSize}px ${cellSize}px`;
        draw();
    }

    // å–å¾—æœ€è¿‘çš„æ ¼é» (ç£å¸åŠŸèƒ½)
    function getClosest(mx, my) {
        const cellSize = canvas.width / (gridSize - 1);
        return { x: Math.round(mx/cellSize)*cellSize, y: Math.round(my/cellSize)*cellSize };
    }

    // æ ¸å¿ƒç¹ªåœ–å¼•æ“
    function draw() {
        const cellSize = canvas.width / (gridSize - 1);
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 1. ç•«èƒŒæ™¯ç¶²æ ¼é»
        for(let i=0; i<gridSize; i++) {
            for(let j=0; j<gridSize; j++) {
                ctx.fillStyle = "#aaa"; 
                ctx.beginPath(); ctx.arc(j*cellSize, i*cellSize, 4, 0, Math.PI*2); ctx.fill();
            }
        }

        // 2. ç•«å·²ç¢ºå®šçš„ç·šæ®µ
        lines.forEach(l => {
            ctx.strokeStyle = l.color; ctx.lineWidth = l.width;
            ctx.beginPath(); ctx.moveTo(l.start.x, l.start.y); ctx.lineTo(l.end.x, l.end.y); ctx.stroke();
        });

        // 3. ç•«æ»‘é¼ è·Ÿéš¨çš„é è¦½ç·š (Ghost Line)
        if(startPoint) {
            ctx.setLineDash([5,5]); ctx.strokeStyle = document.getElementById('lineColor').value; 
            ctx.lineWidth = 2; ctx.beginPath(); 
            ctx.moveTo(startPoint.x, startPoint.y); ctx.lineTo(mousePos.x, mousePos.y); 
            ctx.stroke(); ctx.setLineDash([]);
        }

        // 4. ç•«æ‰‹å‹•æ¨™è¨˜çš„æ–‡å­—
        labels.forEach(lb => {
            ctx.fillStyle = "black"; ctx.font = "bold 20px Arial";
            ctx.fillText(lb.text, lb.x + 8, lb.y - 8);
        });
    }

    // è¨ˆç®—èˆ‡åˆ†é¡åŠŸèƒ½
    function calculateShape() {
        if(lines.length < 3) {
            document.getElementById('infoPanel').innerHTML = "è«‹è‡³å°‘ç¹ªè£½ 3 æ¢ç·šå½¢æˆå°é–‰åœ–å½¢ï¼";
            return;
        }

        // åŸ·è¡Œè¦–è¦ºåŒ–å¡«è‰²
        ctx.fillStyle = "rgba(33, 150, 243, 0.25)";
        ctx.beginPath(); ctx.moveTo(lines[0].start.x, lines[0].start.y);
        lines.forEach(l => ctx.lineTo(l.end.x, l.end.y));
        ctx.closePath(); ctx.fill();

        let report = "<strong>åœ–å½¢åˆ†æå ±å‘Šï¼š</strong><br><br>";

        // ä¸‰è§’å½¢ç²¾å¯†åˆ†é¡æ¼”ç®—æ³•
        if(lines.length === 3) {
            const getDistSq = (p1, p2) => Math.pow(p1.x - p2.x, 2) + Math.pow(p1.y - p2.y, 2);
            let sides = lines.map(l => getDistSq(l.start, l.end)).sort((a, b) => a - b);
            let [a2, b2, c2] = sides;
            const eps = 10; // å…è¨±å¾®å°ç¶²æ ¼è¨ˆç®—èª¤å·®

            let angle = (Math.abs(a2 + b2 - c2) < eps) ? "ç›´è§’" : (a2 + b2 < c2) ? "éˆè§’" : "éŠ³è§’";
            let type = (Math.abs(a2-b2)<eps && Math.abs(b2-c2)<eps) ? "æ­£" : (Math.abs(a2-b2)<eps || Math.abs(b2-c2)<eps) ? "ç­‰è…°" : "ä¸ç­‰é‚Š";
            
            report += `ğŸ¯ <strong>åœ–å½¢åç¨±ï¼š</strong> ${type}${angle}ä¸‰è§’å½¢<br>`;
        } else if (lines.length === 4) {
            report += `ğŸ¯ <strong>åœ–å½¢åç¨±ï¼š</strong> å››é‚Šå½¢<br>`;
        } else {
            report += `ğŸ¯ <strong>åœ–å½¢åç¨±ï¼š</strong> ${lines.length} é‚Šå½¢<br>`;
        }

        // é¢ç©èˆ‡å‘¨é•·æç¤º
        report += `
            <hr style="border:0; border-top:1px solid #ccc; margin:15px 0;">
            ğŸ“ <strong>å‘¨é•·æ€éº¼ç®—ï¼Ÿ</strong><br>
            å°‡æ¯ä¸€æ¢é‚Šçš„é•·åº¦ç›¸åŠ ã€‚<br><br>
            ğŸŸ¦ <strong>é¢ç©æ€éº¼çœ‹ï¼Ÿ</strong><br>
            åœ–å½¢å…§éƒ¨å·²ç¶“å¡—ä¸Šè—è‰²ï¼Œè«‹è©¦è‘—ã€Œæ•¸æ ¼å­ã€ï¼š<br>
            å®Œæ•´çš„ 1 æ ¼ç®— 1ï¼Œä¸å®Œæ•´çš„æ ¼å­è©¦è‘—æ‹¼æ¹Šçœ‹çœ‹ï¼
        `;

        document.getElementById('infoPanel').innerHTML = report;
    }

    // äº‹ä»¶ç›£è½ï¼šæ»‘é¼ ç§»å‹• (æ›´æ–°é è¦½ç·š)
    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mousePos = {x: e.clientX - rect.left, y: e.clientY - rect.top};
        draw();
    });

    // äº‹ä»¶ç›£è½ï¼šå·¦éµé»æ“Š (ç•«ç·š)
    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const p = getClosest(e.clientX - rect.left, e.clientY - rect.top);
        
        if(startPoint) {
            lines.push({
                start: startPoint, end: p, 
                color: document.getElementById('lineColor').value, 
                width: document.getElementById('lineWidth').value
            });
            startPoint = null;
        } else { 
            startPoint = p; 
        }
        draw();
    });

    // äº‹ä»¶ç›£è½ï¼šå³éµé»æ“Š (æ¨™è¨»é ‚é»)
    canvas.addEventListener('contextmenu', (e) => {
        e.preventDefault(); // é˜»æ­¢ç€è¦½å™¨é è¨­å³éµé¸å–®
        const rect = canvas.getBoundingClientRect();
        const p = getClosest(e.clientX - rect.left, e.clientY - rect.top);
        const name = prompt("è«‹ç‚ºé€™å€‹é»è¼¸å…¥åç¨± (ä¾‹å¦‚ A, B, ç”², ä¹™):", "A");
        if(name) {
            labels.push({x: p.x, y: p.y, text: name});
            draw();
        }
    });

    // å·¥å…·æŒ‰éˆ•åŠŸèƒ½
    function undoLastLine() { lines.pop(); draw(); }
    function clearCanvas() { 
        lines = []; labels = []; startPoint = null; draw(); 
        document.getElementById('infoPanel').innerHTML = "å·²æ¸…ç©ºï¼Œè«‹é‡æ–°é–‹å§‹ç¹ªè£½ã€‚";
    }

    // ç¶²æ ¼è®Šæ›´èˆ‡è¦–çª—ç¸®æ”¾å°é½Š
    document.getElementById('gridSize').addEventListener('change', (e) => { 
        gridSize = parseInt(e.target.value); 
        clearCanvas(); 
        init(); 
    });
    window.addEventListener('resize', init);
    
    // å•Ÿå‹•ç¨‹å¼
    window.onload = init;
</script>
</body>
</html>

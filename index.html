<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>幾何繪圖學習工具</title>
    <style>
        body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; background: #f0f2f5; }
        .controls { background: white; padding: 15px; border-radius: 8px; margin: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        #canvas-container { width: 90vw; max-width: 700px; aspect-ratio: 1 / 1; background: white; border: 2px solid #ccc; position: relative; touch-action: none; }
        canvas { width: 100%; height: 100%; display: block; }
    </style>
</head>
<body>

<div class="controls">
    <select id="gridSize">
        <option value="5">5x5 網格</option>
        <option value="9">9x9 網格</option>
        <option value="16">16x16 網格</option>
    </select>
    <input type="color" id="lineColor" value="#000000">
    <input type="range" id="lineWidth" min="1" max="10" value="3">
    <button onclick="clearCanvas()">清除重繪</button>
</div>

<div id="canvas-container">
    <canvas id="gridCanvas"></canvas>
</div>

<script>
    const canvas = document.getElementById('gridCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('canvas-container');
    
    let gridSize = 5;
    let points = [];
    let lines = [];
    let startPoint = null;
    let mousePos = {x: 0, y: 0};

    function init() {
        // 設定畫布解析度
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
        updateGrid();
    }

    function updateGrid() {
        gridSize = parseInt(document.getElementById('gridSize').value);
        points = [];
        const margin = 40;
        const spacing = (canvas.width - margin * 2) / (gridSize - 1);
        for(let i=0; i<gridSize; i++) {
            for(let j=0; j<gridSize; j++) {
                points.push({x: margin + j * spacing, y: margin + i * spacing});
            }
        }
        draw();
    }

    function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // 畫點
        points.forEach(p => {
            ctx.beginPath();
            ctx.arc(p.x, p.y, 4, 0, Math.PI * 2);
            ctx.fillStyle = "#bbb";
            ctx.fill();
        });

        // 畫已完成線條
        lines.forEach(line => {
            ctx.beginPath();
            ctx.moveTo(line.start.x, line.start.y);
            ctx.lineTo(line.end.x, line.end.y);
            ctx.strokeStyle = line.color;
            ctx.lineWidth = line.width;
            ctx.stroke();
        });

        // 畫預覽線 (Ghost Line)
        if (startPoint) {
            ctx.beginPath();
            ctx.moveTo(startPoint.x, startPoint.y);
            ctx.lineTo(mousePos.x, mousePos.y);
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = "rgba(0,0,0,0.5)";
            ctx.lineWidth = 1;
            ctx.stroke();
            ctx.setLineDash([]);
        }
    }

    canvas.addEventListener('mousemove', (e) => {
        const rect = canvas.getBoundingClientRect();
        mousePos = {x: e.clientX - rect.left, y: e.clientY - rect.top};
        draw();
    });

    canvas.addEventListener('click', (e) => {
        const rect = canvas.getBoundingClientRect();
        const mx = e.clientX - rect.left;
        const my = e.clientY - rect.top;
        
        // 磁吸效果
        const clickedPoint = points.find(p => Math.hypot(p.x - mx, p.y - my) < 30);
        
        if (clickedPoint) {
            if (startPoint) {
                lines.push({
                    start: startPoint, 
                    end: clickedPoint, 
                    color: document.getElementById('lineColor').value,
                    width: document.getElementById('lineWidth').value
                });
                startPoint = null;
            } else {
                startPoint = clickedPoint;
            }
        }
        draw();
    });

    function clearCanvas() { lines = []; startPoint = null; draw(); }

    document.getElementById('gridSize').addEventListener('change', updateGrid);
    window.addEventListener('resize', init);
    init();
</script>
</body>
</html>